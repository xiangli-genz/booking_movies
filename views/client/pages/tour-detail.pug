// Script để thêm vào cuối file tour-detail.pug

document.addEventListener('DOMContentLoaded', function() {
  const selectedSeats = [];
  const combos = {
    popcorn: { quantity: 0, price: 45000, name: 'Bắp Rang Bơ' },
    coke: { quantity: 0, price: 35000, name: 'Nước Ngọt' },
    hotdog: { quantity: 0, price: 30000, name: 'Hotdog' },
    water: { quantity: 0, price: 15000, name: 'Nước Suối' },
    comboset: { quantity: 0, price: 95000, name: 'Combo Set' }
  };
  
  // Lưu vào window để script cart có thể truy cập
  window.selectedSeats = selectedSeats;
  window.selectedCombos = combos;
  
  // Seat Selection
  const seats = document.querySelectorAll('.seat:not(.seat-booked)');
  seats.forEach(seat => {
    seat.addEventListener('click', function() {
      if(this.classList.contains('seat-selected')) {
        this.classList.remove('seat-selected');
        const index = selectedSeats.indexOf(this.dataset.seat);
        if(index > -1) selectedSeats.splice(index, 1);
      } else {
        this.classList.add('seat-selected');
        selectedSeats.push(this.dataset.seat);
      }
      updateDisplay();
    });
  });
  
  // Combo Selection
  document.querySelectorAll('.btn-plus').forEach(btn => {
    btn.addEventListener('click', function() {
      const combo = this.dataset.combo;
      combos[combo].quantity++;
      document.querySelector(`input[data-combo-input="${combo}"]`).value = combos[combo].quantity;
      updateDisplay();
    });
  });
  
  document.querySelectorAll('.btn-minus').forEach(btn => {
    btn.addEventListener('click', function() {
      const combo = this.dataset.combo;
      if(combos[combo].quantity > 0) {
        combos[combo].quantity--;
        document.querySelector(`input[data-combo-input="${combo}"]`).value = combos[combo].quantity;
        updateDisplay();
      }
    });
  });
  
  function updateDisplay() {
    // Update selected seats display
    const seatsDisplay = document.getElementById('selected-seats-display');
    if(selectedSeats.length > 0) {
      seatsDisplay.innerHTML = selectedSeats.join(', ');
    } else {
      seatsDisplay.innerHTML = 'Chưa chọn ghế';
    }
    
    // Calculate seat price
    let seatPrice = 0;
    selectedSeats.forEach(seatId => {
      const seat = document.querySelector(`[data-seat="${seatId}"]`);
      seatPrice += parseInt(seat.dataset.price);
    });
    document.getElementById('seat-price').innerText = seatPrice.toLocaleString('vi-VN') + 'đ';
    
    // Update combo display
    const comboDisplay = document.getElementById('selected-combo-display');
    const selectedCombos = [];
    let comboPrice = 0;
    
    Object.keys(combos).forEach(key => {
      if(combos[key].quantity > 0) {
        selectedCombos.push(`${combos[key].name} x${combos[key].quantity}`);
        comboPrice += combos[key].price * combos[key].quantity;
      }
    });
    
    if(selectedCombos.length > 0) {
      comboDisplay.innerHTML = selectedCombos.join('<br>');
    } else {
      comboDisplay.innerHTML = 'Chưa chọn combo';
    }
    document.getElementById('combo-price').innerText = comboPrice.toLocaleString('vi-VN') + 'đ';
    
    // Update total
    const total = seatPrice + comboPrice;
    document.querySelector('[total-price]').innerText = total.toLocaleString('vi-VN');
    
    // Sync to window
    window.selectedSeats = selectedSeats;
    window.selectedCombos = combos;
  }
});